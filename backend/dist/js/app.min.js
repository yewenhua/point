"use strict";angular.module("app",["ngAnimate","ngCookies","ngTouch","ngStorage","ui.router","ui.bootstrap","ui.load","ui.jq","oc.lazyLoad","pascalprecht.translate","requestManager","DataLoad","divpage","CommonFunction","toaster","angular-md5","interceptor","ng.ueditor","highcharts-ng"]);var app=angular.module("app").config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,a,r){app.controller=e.register,app.directive=t.directive,app.filter=a.register,app.factory=r.factory,app.service=r.service,app.constant=r.constant,app.value=r.value}]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/backend/l10n/",suffix:".js"}),e.preferredLanguage("en"),e.useLocalStorage()}]).config(["$httpProvider",function(e){e.interceptors.push("interceptor")}]);angular.module("app").constant("JQ_CONFIG",{slimScroll:["/backend/vendor/jquery/slimscroll/jquery.slimscroll.min.js"],sortable:["/backend/vendor/jquery/sortable/jquery.sortable.js"],filestyle:["/backend/vendor/jquery/file/bootstrap-filestyle.min.js"],chosen:["/backend/vendor/jquery/chosen/chosen.jquery.min.js","/backend/vendor/jquery/chosen/chosen.css"],footable:["/backend/vendor/jquery/footable/footable.all.min.js","/backend/vendor/jquery/footable/footable.core.css"]}).config(["$ocLazyLoadProvider",function(e){e.config({debug:!1,events:!0,modules:[{name:"angularFileUpload",files:["/backend/vendor/modules/angular-file-upload/angular-file-upload.min.js"]},{name:"angularBootstrapNavTree",files:["/backend/vendor/modules/angular-bootstrap-nav-tree/abn_tree_directive.js","/backend/vendor/modules/angular-bootstrap-nav-tree/abn_tree.css"]}]})}]),angular.module("app").run(["$rootScope","$state","$stateParams","RequestManager","toaster",function(e,t,a,r,s){e.$state=t,e.$stateParams=a,e.$on("$stateChangeStart",function(a,l,o,n,p){function i(){e.userInfo=JSON.parse(sessionStorage.getItem("userInfo"));var t=!1;angular.forEach(e.userInfo.privilege_list,function(e,a){e.page_state==l.name&&(t=!0)}),0==t&&(a.preventDefault(),s.pop("error","微商管理系统","目标页面无权限访问！"))}r.cancel(),"access.signin"!=l.name?sessionStorage.getItem("userInfo")?i():(t.go("access.signin"),a.preventDefault()):sessionStorage.getItem("userInfo")&&(i(),t.go("app.welcome"),a.preventDefault())})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/app/welcome"),e.state("app",{"abstract":!0,url:"/app",templateUrl:path+"tpl/app.html"}).state("app.orderlist",{url:"/orderlist?comid&status&start&end&type",templateUrl:path+"templates/orderlist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/orderlistCtrl.js")}]}}).state("app.userlist",{url:"/userlist",templateUrl:path+"templates/userlist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/userlistCtrl.js")}]}}).state("app.declaration",{url:"/declaration?userid&type",templateUrl:path+"templates/declaration.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/declarationCtrl.js")}]}}).state("app.cashlist",{url:"/cashlist?userid",templateUrl:path+"templates/cashlist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/cashlistCtrl.js")}]}}).state("app.commisionlist",{url:"/commisionlist?userid",templateUrl:path+"templates/commisionlist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/commisionlistCtrl.js")}]}}).state("app.exchangelist",{url:"/exchangelist?userid",templateUrl:path+"templates/exchangelist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/exchangelistCtrl.js")}]}}).state("app.consumelist",{url:"/consumelist?userid",templateUrl:path+"templates/consumelist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/consumelistCtrl.js")}]}}).state("app.useablelist",{url:"/useablelist?userid",templateUrl:path+"templates/useablelist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/useablelistCtrl.js")}]}}).state("app.sharelist",{url:"/sharelist?userid",templateUrl:path+"templates/sharelist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/sharelistCtrl.js")}]}}).state("app.waitlist",{url:"/waitlist?userid",templateUrl:path+"templates/waitlist.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/waitlistCtrl.js")}]}}).state("app.upgrade",{url:"/upgrade",templateUrl:path+"templates/upgrade.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/upgradeCtrl.js")}]}}).state("app.commisionsetting",{url:"/commisionsetting",templateUrl:path+"templates/commisionsetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/commisionsettingCtrl.js")}]}}).state("app.declarationsetting",{url:"/declarationsetting",templateUrl:path+"templates/declarationsetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/declarationsettingCtrl.js")}]}}).state("app.ercode",{url:"/ercode",templateUrl:path+"templates/ercode.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularFileUpload"]).then(function(){return e.load([path+"vendor/poster/designer.js",path+"vendor/poster/spectrum.css",path+"vendor/poster/spectrum.js",path+"js/controllers/ercodeCtrl.js"])})}]}}).state("app.servicesetting",{url:"/servicesetting",templateUrl:path+"templates/servicesetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/servicesettingCtrl.js")}]}}).state("app.wechatsetting",{url:"/wechatsetting",templateUrl:path+"templates/wechatsetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/wechatsettingCtrl.js")}]}}).state("app.smssetting",{url:"/smssetting",templateUrl:path+"templates/smssetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/smssettingCtrl.js")}]}}).state("app.personal",{url:"/personal",templateUrl:path+"templates/personal.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/personalCtrl.js")}]}}).state("app.system",{url:"/system",templateUrl:path+"templates/system.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/systemCtrl.js")}]}}).state("app.chgpwd",{url:"/chgpwd",templateUrl:path+"templates/chgpwd.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/chgpwdCtrl.js")}]}}).state("app.adminsetting",{url:"/adminsetting",templateUrl:path+"templates/adminsetting.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/adminsettingCtrl.js")}]}}).state("app.privilege",{url:"/privilege",templateUrl:path+"templates/privilege.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/privilegeCtrl.js")}]}}).state("app.role",{url:"/role",templateUrl:path+"templates/role.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/roleCtrl.js")}]}}).state("app.log",{url:"/log",templateUrl:path+"templates/log.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/logCtrl.js")}]}}).state("app.category",{url:"/category",templateUrl:path+"templates/category.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularBootstrapNavTree","angularFileUpload"]).then(function(){return e.load([path+"js/controllers/categoryCtrl.js"])})}]}}).state("app.banner",{url:"/banner",templateUrl:path+"templates/banner.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularFileUpload"]).then(function(){return e.load([path+"js/controllers/bannerCtrl.js"])})}]}}).state("app.goodslist",{url:"/goodslist?key&start&end&type",templateUrl:path+"templates/goodslist.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularBootstrapNavTree","angularFileUpload"]).then(function(){return e.load([path+"js/controllers/goodslistCtrl.js"])})}]}}).state("app.welcome",{url:"/welcome",templateUrl:path+"templates/welcome.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/welcomeCtrl.js")}]}}).state("app.userimport",{url:"/userimport",templateUrl:path+"templates/userimport.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularFileUpload"]).then(function(){return e.load([path+"js/controllers/userimportCtrl.js"])})}]}}).state("app.quick",{url:"/quick",templateUrl:path+"templates/quick.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/quickCtrl.js")}]}}).state("app.center",{url:"/center",templateUrl:path+"templates/center.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/centerCtrl.js")}]}}).state("app.department",{url:"/department",templateUrl:path+"templates/department.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/departmentCtrl.js")}]}}).state("app.shareholder",{url:"/shareholder",templateUrl:path+"templates/shareholder.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/shareholderCtrl.js")}]}}).state("app.merchant",{url:"/merchant",templateUrl:path+"templates/merchant.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/merchantCtrl.js")}]}}).state("app.takecash",{url:"/takecash",templateUrl:path+"templates/takecash.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/takecashCtrl.js")}]}}).state("app.wallet",{url:"/wallet",templateUrl:path+"templates/wallet.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/walletCtrl.js")}]}}).state("app.message",{url:"/message",templateUrl:path+"templates/message.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/messageCtrl.js")}]}}).state("app.logistic",{url:"/logistic",templateUrl:path+"templates/logistic.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/logisticCtrl.js")}]}}).state("app.business",{url:"/business",templateUrl:path+"templates/business.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/businessCtrl.js")}]}}).state("app.repeatcompensation",{url:"/repeatcompensation",templateUrl:path+"templates/repeatcompensation.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/repeatcompensationCtrl.js")}]}}).state("app.repeatmanager",{url:"/repeatmanager",templateUrl:path+"templates/repeatmanager.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/repeatmanagerCtrl.js")}]}}).state("app.smstemplate",{url:"/smstemplate",templateUrl:path+"templates/smstemplate.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/smstemplateCtrl.js")}]}}).state("app.article",{url:"/article",templateUrl:path+"templates/article.html",resolve:{deps:["$ocLazyLoad",function(e){return e.load(["angularFileUpload"]).then(function(){return e.load([path+"js/controllers/articleCtrl.js"])})}]}}).state("app.rankorder",{url:"/rankorder",templateUrl:path+"templates/rankorder.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/rankorderCtrl.js")}]}}).state("app.salerank",{url:"/salerank",templateUrl:path+"templates/salerank.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/salerankCtrl.js")}]}}).state("app.merchantgoods",{url:"/merchantgoods",templateUrl:path+"templates/merchantgoods.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/merchantgoodsCtrl.js")}]}}).state("app.salegoods",{url:"/salegoods",templateUrl:path+"templates/salegoods.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/salegoodsCtrl.js")}]}}).state("app.consumerank",{url:"/consumerank",templateUrl:path+"templates/consumerank.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/consumerankCtrl.js")}]}}).state("app.declarationrank",{url:"/declarationrank",templateUrl:path+"templates/declarationrank.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/declarationrankCtrl.js")}]}}).state("app.memberrank",{url:"/memberrank",templateUrl:path+"templates/memberrank.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/memberrankCtrl.js")}]}}).state("app.sharemanager",{url:"/sharemanager",templateUrl:path+"templates/sharemanager.html",resolve:{deps:["uiLoad",function(e){return e.load(path+"js/controllers/sharemanagerCtrl.js")}]}}).state("access",{url:"/access",template:'<div ui-view class="fade-in-right-big smooth"></div>'}).state("access.signin",{url:"/signin",templateUrl:path+"tpl/page_signin.html",resolve:{deps:["uiLoad",function(e){return e.load([path+"js/controllers/signinCtrl.js"])}]}})}]),angular.module("app").controller("AppCtrl",["$scope","$rootScope","$translate","$localStorage","$window","$state","DataLoad","$interval","$timeout",function(e,t,a,r,s,l,o,n,p){function i(e){var t=e.navigator.userAgent||e.navigator.vendor||e.opera;return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(t)}var u=!!navigator.userAgent.match(/MSIE/i);u&&angular.element(s.document.body).addClass("ie"),i(s)&&angular.element(s.document.body).addClass("smart"),e.app={name:"微商之家",version:"2.0",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:10,navbarHeaderColor:"bg-info dker",navbarCollapseColor:"bg-info dk",asideColor:"bg-black",headerFixed:!0,asideFixed:!1,asideFolded:!1,asideDock:!1,container:!1}},angular.isDefined(r.settings)?e.app.settings=r.settings:r.settings=e.app.settings,e.$watch("app.settings",function(){e.app.settings.asideDock&&e.app.settings.asideFixed&&(e.app.settings.headerFixed=!0),r.settings=e.app.settings},!0),t.userInfo=JSON.parse(sessionStorage.getItem("userInfo")),e.logout=function(){t.init=!0,sessionStorage.removeItem("userInfo"),l.go("access.signin");var e=o.logout({});return e.then(function(e){},function(){})},t.init=!0,t.systemInfo={},t.getSystemData=function(){var a=o.getSystemData({});return a.then(function(a){a&&0==a.code?(t.systemInfo=a.data,t.systemInfo.signin_title=t.systemInfo.title+"管理后台",e.app.name=angular.copy(t.systemInfo.title)):(t.systemInfo={},t.systemInfo.title="微商管理系统",t.systemInfo.signin_title="微商后台管理系统",t.systemInfo.author="版权所有")},function(){t.systemInfo={},t.systemInfo.title="微商管理系统",t.systemInfo.signin_title="微商后台管理系统",t.systemInfo.author="版权所有"})},t.getSystemData(),e.currState=l,e.$watch("currState.current.name",function(a,r){if(a&&"access.signin"!=l.current.name){var s=JSON.parse(sessionStorage.getItem("userInfo"));if(!s)return t.init=!0,e.logout(),!1;t.init&&(t.init=!1,e.notify(s))}}),e.notify=function(t){n(function(){e.getNewMessage()},5e3)},e.isPrivilege=function(e){if("access.signin"!=l.current.name){var t=!1,a=JSON.parse(sessionStorage.getItem("userInfo"));return a?(angular.forEach(a.privilege_list,function(a,r){a.page_state==e&&(t=!0)}),0!=t):!1}},e.isOperate=function(e){if("access.signin"!=l.current.name){var t=!1,a=JSON.parse(sessionStorage.getItem("userInfo"));return a?(angular.forEach(a.privilege_list,function(a,r){a.page_state==e&&1==a.writeSelected&&(t=!0)}),0!=t):!1}},t.diffNum_no_review=0,t.alert_no_review_title="",t.goto_state_no_review="",t.diffNum_no_refund=0,t.alert_no_refund_title="",t.goto_state_no_refund="",t.getNewMessage=function(){var a=o.getNewMessage({});return a.then(function(a){a&&0==a.code?(a.waitSendCount>0&&a.waitSendCount!=t.diffNum_no_review&&(t.alert_no_review_title="待发货",t.diffNum_no_review=angular.copy(a.waitSendCount),t.goto_state_no_review="app.orderlist",t.messageType="review",e.playSoundHtml5(t.messageType)),a.waitRefundCount>0&&a.waitRefundCount!=t.diffNum_no_refund&&(t.alert_no_refund_title="待退款",t.diffNum_no_refund=angular.copy(a.waitRefundCount),t.goto_state_no_refund="app.orderlist",t.messageType="refund",e.playSoundHtml5(t.messageType))):($("#closeReviewMessage").fadeOut(),$("#closeRefundMessage").fadeOut())},function(){$("#closeReviewMessage").fadeOut(),$("#closeRefundMessage").fadeOut()})},e.playSoundHtml5=function(e){var t=document.getElementById("playSoundHtml5");t.play(),"review"==e?$("#closeReviewMessage").fadeIn():"refund"==e&&$("#closeRefundMessage").fadeIn()},e.closeReviewMessage=function(e){e.stopPropagation();var t="2016-12-01",a=moment().utc().endOf("day").format("YYYY-MM-DD");$("#closeReviewMessage").fadeOut(),s.location.href="/admin#/app/orderlist?status=1&start="+t+"&end="+a},e.closeReviewMessageOnly=function(e){e.stopPropagation(),$("#closeReviewMessage").fadeOut()},e.closeRefundMessage=function(e){e.stopPropagation();var t="2016-12-01",a=moment().utc().endOf("day").format("YYYY-MM-DD");$("#closeRefundMessage").fadeOut(),s.location.href="/admin#/app/orderlist?status=7&start="+t+"&end="+a},e.closeRefundMessageOnly=function(e){e.stopPropagation(),$("#closeRefundMessage").fadeOut()}}]).directive("ngEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter)}),t.preventDefault())})}}),angular.module("app").filter("sizeFilter",function(){return function(e){var t="";if(e>1024){var a=e/1024;t=a.toFixed(2)+" G"}else t=e+" M";return t}});