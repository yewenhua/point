angular.module("app").controller("MerchantgoodsCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams","$window",function(t,a,e,o,n,l,r,d){t.haveData=!0,t.loading=!0,t.query="",t.page=1,t.totalPage=1,t.perPage=20,t.dataList=[],t.init=!0,t.submit=!1,t.total={total_all:0,total_release:0,total_down:0,total_recommend:0,total_timebuy:0},angular.isUndefined(r.userid)?t.userid="empty":t.userid=r.userid,t.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},t.$watch("dateSelectSingle.start",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.monthAgo=function(){var t=new Date,a=t.getTime()-2592e6,e=new Date;e.setTime(a);var o=moment(e).utc().startOf("day").format("YYYY-MM-DD");return o},t.dateSelectRange={start:moment(new Date("2016-12-01")).utc().startOf("day"),end:moment().utc().startOf("day")},t.$watch("dateSelectRange",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.getAllData=function(){t.loading=!0;var a=e.getMerchantGoodsPageData({searchkey:t.query,start:t.dateSelectRange.start.format("YYYY-MM-DD"),end:t.dateSelectRange.end.format("YYYY-MM-DD"),offset:(t.page-1)*t.perPage,num:t.perPage,userid:t.userid});return a.then(function(a){if(a&&0==a.code)if(t.total.total_all=a.data.total_all,t.total.total_release=a.data.total_release,t.total.total_down=a.data.total_down,t.total.total_recommend=a.data.total_recommend,t.total.total_timebuy=a.data.total_timebuy,0!=a.data.data.length){t.haveData=!0,t.dataList=a.data.data,t.totalPage=Math.ceil(a.data.count/t.perPage);var e=$("#divpage-page");n.getready(e,t.totalPage,t.page)}else t.dataList=[],o.pop("success","商家商品","没有数据！"),t.haveData=!1;else t.dataList=[],t.haveData=!1,o.pop("error","商家商品",a.message);t.loading=!1},function(){t.dataList=[],t.haveData=!1,t.loading=!1,o.pop("error","商家商品","获取数据出错！")})},t.getAllData(),t.isFirst=function(t){return 1==t},t.isDisable=function(a){return 1==a&&1==t.totalPage?!0:!(a<t.totalPage)},t.getInfoPage=function(a){a<=t.totalPage&&a>0&&(t.page=a,t.getAllData())},t.divpageByPage=function(a){var e=$(a.currentTarget).html(),o=Number(e);angular.isNumber(o)&&o>0&&t.getInfoPage(o)},t.searchData=function(){t.page=1,t.getAllData()},t.goto_detail=function(a,e){var o=t.dateSelectRange.start.format("YYYY-MM-DD"),n=t.dateSelectRange.end.format("YYYY-MM-DD"),l="";"total"==e?l=99:"release"==e?l=1:"down"==e?l=2:"recommend"==e?l=3:"time"==e&&(l=4),d.location.href="/admin#/app/goodslist?key="+a.mobile+"&type="+l+"&start="+o+"&end="+n}}]);