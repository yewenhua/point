angular.module("app").controller("CommisionlistCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams",function(a,e,t,n,l,i,o){a.haveData=!0,a.loading=!0,a.query="",a.page=1,a.totalPage=1,a.perPage=10,a.dataList=[],a.init=!0,a.selectAll=!1,a.all_delete_disabled=!0,a.all_delete_html="删除",a.submit=!1,a.commision=0,a.order_money=0,a.pay_money=0,a.radioModel=99,a.init_loading=!0,angular.isUndefined(o.userid)?a.userid="empty":a.userid=o.userid,a.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},a.$watch("dateSelectSingle.start",function(e,t){e!=t&&(a.init=!1,a.page=1,a.getAllData())},!0),a.$watch("radioModel",function(e,t){e!=t&&(a.init_loading||(a.page=1,a.getAllData()))}),a.monthAgo=function(){var a=new Date,e=a.getTime()-2592e6,t=new Date;t.setTime(e);var n=moment(t).utc().startOf("day").format("YYYY-MM-DD");return n},a.dateSelectRange={start:moment(a.monthAgo()).utc().startOf("day"),end:moment().utc().startOf("day")},a.$watch("dateSelectRange",function(e,t){e!=t&&(a.init=!1,a.page=1,a.getAllData())},!0),a.getAllData=function(){a.loading=!0;var e=t.getCommisionPageData({searchkey:a.query,type:a.radioModel,start:a.dateSelectRange.start.format("YYYY-MM-DD"),end:a.dateSelectRange.end.format("YYYY-MM-DD"),offset:(a.page-1)*a.perPage,num:a.perPage,userid:a.userid});return e.then(function(e){if(e&&0==e.code)if(a.commision=e.data.commision,a.order_money=e.data.order_money,a.pay_money=e.data.pay_money,0!=e.data.data.length){a.haveData=!0,a.dataList=e.data.data,a.totalPage=Math.ceil(e.data.count/a.perPage);var t=$("#divpage-page");l.getready(t,a.totalPage,a.page)}else a.dataList=[],n.pop("success","佣金记录","没有数据！"),a.haveData=!1;else a.commision=0,a.order_money=0,a.pay_money=0,a.dataList=[],a.haveData=!1,n.pop("error","佣金记录",e.message);a.loading=!1,a.init_loading=!1},function(){a.commision=0,a.order_money=0,a.pay_money=0,a.dataList=[],a.haveData=!1,a.loading=!1,a.init_loading=!1,n.pop("error","佣金记录","获取数据出错！")})},a.getAllData(),a.isFirst=function(a){return 1==a},a.isDisable=function(e){return 1==e&&1==a.totalPage?!0:!(e<a.totalPage)},a.getInfoPage=function(e){e<=a.totalPage&&e>0&&(a.page=e,a.getAllData())},a.divpageByPage=function(e){var t=$(e.currentTarget).html(),n=Number(t);angular.isNumber(n)&&n>0&&a.getInfoPage(n)},a.searchData=function(){a.page=1,a.getAllData()},a.$watch("dataList",function(e,t){e!=t&&a.dataList.length>0&&(a.num=0,a.all=0,angular.forEach(a.dataList,function(e,t){e.selected&&a.num++,a.all++}),a.num>0?a.all_delete_disabled=!1:a.all_delete_disabled=!0,a.num==a.all?a.selectAll=!0:a.selectAll=!1)},!0),a.$watch("selectAll",function(e,t){e!=t&&a.dataList.length>0&&(e?angular.forEach(a.dataList,function(a,e){a.selected=!0}):(a.count=0,a.all=0,angular.forEach(a.dataList,function(e,t){e.selected&&a.count++,a.all++}),a.count==a.all&&angular.forEach(a.dataList,function(a,e){a.selected=!1})))}),a.deleteBatch=function(){if(1==confirm("确定要删除吗?")&&0==a.submit){a.submit=!0,a.idlist=[],angular.forEach(a.dataList,function(e,t){1==e.selected&&a.idlist.push(e.id)}),a.all_delete_disabled=!0;var e=t.deleteCommisionBatch({idlist:JSON.stringify(a.idlist)});return e.then(function(e){a.all_delete_disabled=!1,a.all_delete_html="删除",e&&0==e.code?(n.pop("success","佣金记录",e.message),a.page=1,a.getAllData()):(a.submit=!1,n.pop("error","佣金记录",e.message))},function(){a.submit=!1,a.all_delete_disabled=!1,a.all_delete_html="删除",n.pop("error","佣金记录","操作出错！")})}}}]);