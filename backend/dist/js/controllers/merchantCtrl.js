angular.module("app").controller("MerchantCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams","$window",function(t,a,e,o,r,s,n,l){t.haveData=!0,t.loading=!0,t.query="",t.page=1,t.totalPage=1,t.perPage=10,t.dataList=[],t.init=!0,t.submit=!1,t.sort={word:"total",type:"desc"},t.total={total_order:0,total_consume:0,total_exchange:0,total_com_useable:0,total_com_consume:0,total_cash:0,total_logistic:0},t.thList=[{name:"订单数量",sort:"fa-sort-desc",selected:!0},{name:"消费积分",sort:"fa-sort",selected:!1},{name:"购物券",sort:"fa-sort",selected:!1},{name:"现金",sort:"fa-sort",selected:!1},{name:"邮费",sort:"fa-sort",selected:!1},{name:"结算可用积分",sort:"fa-sort",selected:!1},{name:"结算消费积分",sort:"fa-sort",selected:!1}],t.changeSort=function(a){a.selected?"fa-sort-asc"==a.sort?(a.sort="fa-sort-desc",t.sort.type="desc"):(a.sort="fa-sort-asc",t.sort.type="asc"):(a.selected=!0,a.sort="fa-sort-desc",t.sort.type="desc",angular.forEach(t.thList,function(t,e){a.name!=t.name&&(t.selected=!1,t.sort="fa-sort")})),"订单数量"==a.name?t.sort.word="total":"消费积分"==a.name?t.sort.word="consume_point":"购物券"==a.name?t.sort.word="exchange_point":"现金"==a.name?t.sort.word="cash":"邮费"==a.name?t.sort.word="logistic_fee":"结算可用积分"==a.name?t.sort.word="merchantUseablePoint":"结算消费积分"==a.name?t.sort.word="merchantConsumePoint":t.sort.word="total"},t.$watch("sort",function(a,e){a!=e&&(t.page=1,t.getAllData())},!0),angular.isUndefined(n.userid)?t.userid="empty":t.userid=n.userid,t.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},t.$watch("dateSelectSingle.start",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.monthAgo=function(){var t=new Date,a=t.getTime()-2592e6,e=new Date;e.setTime(a);var o=moment(e).utc().startOf("day").format("YYYY-MM-DD");return o},t.dateSelectRange={start:moment(t.monthAgo()).utc().startOf("day"),end:moment().utc().startOf("day")},t.$watch("dateSelectRange",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.getAllData=function(){t.loading=!0;var a=e.getMerchantStatisticPageData({searchkey:t.query,start:t.dateSelectRange.start.format("YYYY-MM-DD"),end:t.dateSelectRange.end.format("YYYY-MM-DD"),offset:(t.page-1)*t.perPage,num:t.perPage,userid:t.userid,sort_word:t.sort.word,sort_type:t.sort.type});return a.then(function(a){if(a&&0==a.code)if(t.total.total_order=a.data.total_order,t.total.total_consume=a.data.total_consume,t.total.total_exchange=a.data.total_exchange,t.total.total_cash=a.data.total_cash,t.total.total_logistic=a.data.total_logistic,t.total.total_com_useable=a.data.total_com_useable,t.total.total_com_consume=a.data.total_com_consume,0!=a.data.data.length){t.haveData=!0,t.dataList=a.data.data,t.totalPage=Math.ceil(a.data.count/t.perPage);var e=$("#divpage-page");r.getready(e,t.totalPage,t.page)}else t.dataList=[],o.pop("success","商家排行","没有数据！"),t.haveData=!1;else t.dataList=[],t.haveData=!1,o.pop("error","商家排行",a.message);t.loading=!1},function(){t.dataList=[],t.haveData=!1,t.loading=!1,o.pop("error","商家排行","获取数据出错！")})},t.getAllData(),t.isFirst=function(t){return 1==t},t.isDisable=function(a){return 1==a&&1==t.totalPage?!0:!(a<t.totalPage)},t.getInfoPage=function(a){a<=t.totalPage&&a>0&&(t.page=a,t.getAllData())},t.divpageByPage=function(a){var e=$(a.currentTarget).html(),o=Number(e);angular.isNumber(o)&&o>0&&t.getInfoPage(o)},t.searchData=function(){t.page=1,t.getAllData()},t.detail=function(a){var e=t.dateSelectRange.start.format("YYYY-MM-DD"),o=t.dateSelectRange.end.format("YYYY-MM-DD");l.location.href="/admin#/app/orderlist?comid="+a.user_id+"&status=3&start="+e+"&end="+o+"&type=merchant"}}]);