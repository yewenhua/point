angular.module("app").controller("UserimportCtrl",["$rootScope","$scope","toaster","$state","DataLoad","FileUploader","$timeout",function(e,t,a,s,r,o,l){t.submitBtnHtml="提交导入",t.importDisabled=!0,t.importData={},t.importData.url="",t.uploadBatch=function(){angular.forEach(t.uploader.queue,function(e){t.importData.url="backend/uploads/"+e.file.save_file_name});var e=r.batchMemberImport({url:t.importData.url});return e.then(function(e){t.submitBtnHtml="提交导入",$this.removeClass("btn_disable").addClass("btn-success"),e&&0==e.code?(a.pop("success","批量导入",e.message),l(function(){s.go("app.userlist")},2e3)):a.pop("error","批量导入",e.message)},function(){t.submitBtnHtml="提交导入",$this.removeClass("btn_disable").addClass("btn-success"),a.pop("error","批量导入","批量导入出错！")})},t.submitUpload=function(e){return t.uploader.queue.length<=0?(a.pop("error","批量导入","导入文件不能为空！"),!1):void(1==confirm("确定要导入吗?")&&(t.submitBtnHtml="导入中…",$this=$(e.currentTarget),$this.removeClass("btn-success").addClass("btn_disable"),n.uploadAll()))};var n=t.uploader=new o({url:"/backend/upload_soft.php"});n.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),n.onAfterAddingFile=function(e){t.uploader.queue.length>1&&t.uploader.queue.splice(0,1),angular.forEach(t.uploader.queue,function(e){var s=e.file.name;return-1===s.indexOf(".xls")&&-1===s.indexOf(".xlsx")?(t.importDisabled=!0,a.pop("error","批量导入","导入文件格式必须为EXCEL（xls或xlsx后缀结尾）！"),!1):void(t.importDisabled=!1)})},n.onCompleteItem=function(e,s,r,o){0==s.code?($(".bootstrap-filestyle").children("input").val(""),e.file.save_file_name=s.file,t.uploadBatch()):(a.pop("error","批量导入",s.answer),t.submitBtnHtml="提交导入",$this.removeClass("btn_disable").addClass("btn-success"))}}]);