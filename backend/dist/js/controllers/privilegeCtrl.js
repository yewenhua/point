"use strict";app.controller("PrivilegeCtrl",["$rootScope","$scope","$http","$state","toaster","$timeout","DataLoad","$location","divpage",function(e,a,i,t,r,g,n,p,o){a.privilege={page_name:"",page_url:"",page_desc:"",isNew:!0},a.editing=!1,a.creating=!1,a.haveData=!0,a.loading=!0,a.query="",a.page=1,a.totalPage=1,a.perPage=10,a.dataList=[],a.cancel=function(){a.editing=!1,a.creating=!1},a.isFirst=function(e){return 1==e},a.isDisable=function(e){return 1==e&&1==a.totalPage?!0:!(e<a.totalPage)},a.getInfoPage=function(e){e<=a.totalPage&&e>0&&(a.page=e,a.getAllData())},a.divpageByPage=function(e){var i=$(e.currentTarget).html(),t=Number(i);angular.isNumber(t)&&t>0&&a.getInfoPage(t)},a.searchData=function(){a.page=1,a.getAllData()},a.getAllData=function(){var e=n.getPrivilegePageData({searchkey:a.query,offset:(a.page-1)*a.perPage,num:a.perPage});return e.then(function(e){if(e&&0==e.code)if(0!=e.data.data.length){a.haveData=!0,a.dataList=e.data.data,a.totalPage=Math.ceil(e.data.count/a.perPage);var i=$("#divpage-page");o.getready(i,a.totalPage,a.page)}else a.dataList=[],r.pop("success"," 权限设置","没有数据！"),a.haveData=!1;else a.dataList=[],a.haveData=!1,r.pop("error"," 权限设置",e.message);a.loading=!1},function(){a.dataList=[],a.haveData=!1,a.loading=!1,r.pop("error"," 权限设置"," 获取权限列表出错！")})},a.getAllData(),a.active=!1,a.editPrivilege=function(){if(""==a.privilege.name)return r.pop("error","权限设置","页面名称不能为空！"),!1;if(""==a.privilege.state)return r.pop("error","权限设置","页面URL不能为空！"),!1;if(""==a.privilege.desc)return r.pop("error","权限设置","页面描述不能为空！"),!1;if(0==a.active){a.active=!0;var e=n.editPrivilege({id:a.privilege.isNew?"":a.privilege.id,page_name:a.privilege.page_name,page_url:a.privilege.page_url,page_desc:a.privilege.page_desc});return e.then(function(e){e&&0==e.code?(r.pop("success","权限设置","修改成功！"),1==a.privilege.isNew&&(a.privilege.id=e.data,a.privilege.isNew=!1),a.privilege={page_name:"",page_url:"",page_desc:"",isNew:!1},a.editing=!1,a.creating=!1,a.haveData=!0,a.loading=!0,a.getAllData()):r.pop("error","权限设置","权限设置出错！"),a.active=!1},function(){a.active=!1,r.pop("error","权限设置","未知错误，请刷新重试！")})}},a.createPrivilege=function(){a.privilege={page_name:"",page_url:"",page_desc:"",isNew:!0},a.creating=!0},a.updatePrivilege=function(e){a.editing=!0,a.privilege=angular.copy(e),a.privilege.isNew=!1},a.deletePrivilege=function(e){1==confirm("确定要删除吗?")&&a.deletePrivilegeNow(e)},a.deletePrivilegeNow=function(e){var i=n.deletePrivilege({id:e.id});return i.then(function(e){e&&0==e.code?(r.pop("success","权限设置",e.message),a.getAllData()):r.pop("error","权限设置",e.message)},function(){r.pop("error","权限设置"," 删除权限设置出错！")})}}]);