angular.module("app").controller("TakecashCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams",function(e,t,a,n,l,i,o){e.haveData=!0,e.loading=!0,e.query="",e.page=1,e.totalPage=1,e.perPage=10,e.dataList=[],e.init=!0,e.selectAll=!1,e.all_delete_disabled=!0,e.all_delete_html="删除",e.submit=!1,e.init_loading=!0,e.radioModel=99,e.submit_money=0,e.get_money=0,angular.isUndefined(o.userid)?e.userid="empty":e.userid=o.userid,e.$watch("radioModel",function(t,a){t!=a&&(e.init_loading||(e.page=1,e.getAllData()))}),e.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},e.$watch("dateSelectSingle.start",function(t,a){t!=a&&(e.init=!1,e.page=1,e.getAllData())},!0),e.monthAgo=function(){var e=new Date,t=e.getTime()-2592e6,a=new Date;a.setTime(t);var n=moment(a).utc().startOf("day").format("YYYY-MM-DD");return n},e.dateSelectRange={start:moment(e.monthAgo()).utc().startOf("day"),end:moment().utc().startOf("day")},e.$watch("dateSelectRange",function(t,a){t!=a&&(e.init=!1,e.page=1,e.getAllData())},!0),e.getAllData=function(){e.loading=!0;var t=a.getTakecashPageData({searchkey:e.query,status:e.radioModel,start:e.dateSelectRange.start.format("YYYY-MM-DD"),end:e.dateSelectRange.end.format("YYYY-MM-DD"),offset:(e.page-1)*e.perPage,num:e.perPage,userid:e.userid});return t.then(function(t){if(t&&0==t.code)if(e.submit_money=t.data.submit_money,e.get_money=t.data.get_money,0!=t.data.data.length){e.haveData=!0,e.dataList=t.data.data,e.totalPage=Math.ceil(t.data.count/e.perPage);var a=$("#divpage-page");l.getready(a,e.totalPage,e.page)}else e.dataList=[],n.pop("success","提现管理","没有数据！"),e.haveData=!1;else e.submit_money=0,e.get_money=0,e.dataList=[],e.haveData=!1,n.pop("error","提现管理",t.message);e.loading=!1,e.init_loading=!1},function(){e.submit_money=0,e.get_money=0,e.dataList=[],e.haveData=!1,e.loading=!1,e.init_loading=!1,n.pop("error","提现管理","获取数据出错！")})},e.getAllData(),e.isFirst=function(e){return 1==e},e.isDisable=function(t){return 1==t&&1==e.totalPage?!0:!(t<e.totalPage)},e.getInfoPage=function(t){t<=e.totalPage&&t>0&&(e.page=t,e.getAllData())},e.divpageByPage=function(t){var a=$(t.currentTarget).html(),n=Number(a);angular.isNumber(n)&&n>0&&e.getInfoPage(n)},e.searchData=function(){e.page=1,e.getAllData()},e.$watch("dataList",function(t,a){t!=a&&e.dataList.length>0&&(e.num=0,e.all=0,angular.forEach(e.dataList,function(t,a){t.selected&&e.num++,e.all++}),e.num>0?e.all_delete_disabled=!1:e.all_delete_disabled=!0,e.num==e.all?e.selectAll=!0:e.selectAll=!1)},!0),e.$watch("selectAll",function(t,a){t!=a&&e.dataList.length>0&&(t?angular.forEach(e.dataList,function(e,t){e.selected=!0}):(e.count=0,e.all=0,angular.forEach(e.dataList,function(t,a){t.selected&&e.count++,e.all++}),e.count==e.all&&angular.forEach(e.dataList,function(e,t){e.selected=!1})))}),e.deleteBatch=function(){if(1==confirm("确定要删除吗?")&&0==e.submit){e.submit=!0,e.idlist=[],angular.forEach(e.dataList,function(t,a){1==t.selected&&e.idlist.push(t.id)});var t=a.deleteTakecashBatch({idlist:JSON.stringify(e.idlist)});return t.then(function(t){e.all_disagree_disabled=!1,e.all_delete_html="删除",t&&0==t.code?(n.pop("success","提现管理",t.message),location.reload()):(e.submit=!1,n.pop("error","提现管理",t.message))},function(){e.submit=!1,e.all_disagree_disabled=!1,e.all_delete_html="删除",n.pop("error","提现管理","操作出错！")})}},e.open=function(t,a){var n=i.open({templateUrl:"takecashModalContent",controller:"takecashModalInstanceCtrl",size:a,resolve:{item:function(){return t}}});n.result.then(function(t){angular.isDefined(t)&&angular.isDefined(t.type)&&"update"==t.type&&e.getAllData()},function(){})}}]),angular.module("app").controller("takecashModalInstanceCtrl",["$rootScope","$scope","$modalInstance","toaster","item","DataLoad",function(e,t,a,n,l,i){t.item=angular.copy(l),t.submit=!1,t.cancle=function(){var e={type:"cancel"};a.close(e)},t.update=function(){var e={type:"update"};a.close(e)},t.agree_html="通过",t.agree=function(){layer.confirm("确定通过吗",{btn:["确定","取消"]},function(){if(layer.closeAll("dialog"),0==t.submit){t.submit=!0;var e=1;t.agree_html="提交中…";var a=i.checkTakecash({id:t.item.id,status:e});return a.then(function(e){t.agree_html="通过",e&&0==e.code?(n.pop("success","提现管理",e.message),t.update()):(t.submit=!1,n.pop("error","提现管理",e.message))},function(){t.submit=!1,t.agree_html="通过",n.pop("error","提现管理","操作出错！")})}},function(){})},t.disagree_html="不通过",t.disagree=function(){layer.confirm("款项金额将退回至用户钱包",{btn:["确定","取消"],title:"确定要不通过吗？",icon:3},function(){if(layer.closeAll("dialog"),0==t.submit){t.submit=!0;var e=2;t.disagree_html="提交中…";var a=i.checkTakecash({id:t.item.id,status:e});return a.then(function(e){t.disagree_html="不通过",e&&0==e.code?(n.pop("success","提现管理",e.message),t.update()):(t.submit=!1,n.pop("error","提现管理",e.message))},function(){t.submit=!1,t.disagree_html="不通过",n.pop("error","提现管理","操作出错！")})}},function(){})}}]);