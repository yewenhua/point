angular.module("app").controller("RankorderCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams","$window",function(t,a,e,o,d,n,l,r){t.haveData=!0,t.loading=!0,t.query="",t.page=1,t.totalPage=1,t.perPage=20,t.dataList=[],t.init=!0,t.submit=!1,t.total={total_order:0,total_wait_send:0,total_already_send:0,total_completed:0,total_closed:0,total_cash:0,total_refunded:0},angular.isUndefined(l.userid)?t.userid="empty":t.userid=l.userid,t.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},t.$watch("dateSelectSingle.start",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.monthAgo=function(){var t=new Date,a=t.getTime()-2592e6,e=new Date;e.setTime(a);var o=moment(e).utc().startOf("day").format("YYYY-MM-DD");return o},t.dateSelectRange={start:moment(new Date("2016-12-01")).utc().startOf("day"),end:moment().utc().startOf("day")},t.$watch("dateSelectRange",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.getAllData=function(){t.loading=!0;var a=e.getMerchantOrderPageData({searchkey:t.query,start:t.dateSelectRange.start.format("YYYY-MM-DD"),end:t.dateSelectRange.end.format("YYYY-MM-DD"),offset:(t.page-1)*t.perPage,num:t.perPage,userid:t.userid});return a.then(function(a){if(a&&0==a.code)if(t.total.total_order=a.data.total_order,t.total.total_wait_send=a.data.total_wait_send,t.total.total_already_send=a.data.total_already_send,t.total.total_completed=a.data.total_completed,t.total.total_closed=a.data.total_closed,t.total.total_refunded=a.data.total_refunded,0!=a.data.data.length){t.haveData=!0,t.dataList=a.data.data,t.totalPage=Math.ceil(a.data.count/t.perPage);var e=$("#divpage-page");d.getready(e,t.totalPage,t.page)}else t.dataList=[],o.pop("success","商家订单","没有数据！"),t.haveData=!1;else t.dataList=[],t.haveData=!1,o.pop("error","商家订单",a.message);t.loading=!1},function(){t.dataList=[],t.haveData=!1,t.loading=!1,o.pop("error","商家订单","获取数据出错！")})},t.getAllData(),t.isFirst=function(t){return 1==t},t.isDisable=function(a){return 1==a&&1==t.totalPage?!0:!(a<t.totalPage)},t.getInfoPage=function(a){a<=t.totalPage&&a>0&&(t.page=a,t.getAllData())},t.divpageByPage=function(a){var e=$(a.currentTarget).html(),o=Number(e);angular.isNumber(o)&&o>0&&t.getInfoPage(o)},t.searchData=function(){t.page=1,t.getAllData()},t.goto_detail=function(a,e){var o=t.dateSelectRange.start.format("YYYY-MM-DD"),d=t.dateSelectRange.end.format("YYYY-MM-DD"),n="";"total"==e?n=99:"wait_send"==e?n=1:"already_send"==e?n=2:"completed"==e?n=3:"closed"==e?n=4:"refunded"==e&&(n=6),r.location.href="/admin#/app/orderlist?comid="+a.uid+"&status="+n+"&start="+o+"&end="+d}}]);