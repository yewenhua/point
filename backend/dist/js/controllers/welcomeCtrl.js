"use strict";angular.module("app").controller("WelcomeCtrl",["$scope","DataLoad","$window",function(a,t,e){a.haveData=!0,a.loading=!0,a.orderData=[],a.statusNum=null,a.allOrderNum=0,a.monthData=null,a.cashData=null,a.haveOrderGraphData=!1,a.haveCashGraphData=!1,a.allCash=0,a.chartConfig={cashArea:{options:{chart:{type:"area",height:310},tooltip:{pointFormat:"总现金流量： <b>{point.y:,.0f}元</b>"},plotOptions:{area:{marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}}},title:{text:"近一个月内订单现金流量走势图"},subtitle:{text:""},xAxis:{categories:[]},yAxis:{title:{text:""},labels:{formatter:function(){return this.value/1e4+"万元"}}},series:[{type:"area",name:"订单现金额",data:[]}]},orderArea:{options:{chart:{type:"area",height:400},tooltip:{pointFormat:"订单量： <b>{point.y:,.0f}单</b>"},plotOptions:{area:{marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}}},title:{text:"近一个月内订单量走势图"},subtitle:{text:""},xAxis:{categories:[]},yAxis:{title:{text:""},labels:{formatter:function(){return this.value+"单"}}},series:[{type:"area",name:"订单",data:[]}]}},a.allOrderStatusData=function(){a.loading=!0,a.haveOrderGraphData=!1;var e=t.allOrderStatusData({});return e.then(function(t){if(t&&0==t.code){a.orderData=t.data,a.statusNum=t.statusNum,a.allOrderNum=t.allOrderNum,a.monthData=t.monthData;var e=[],r=[];angular.forEach(a.monthData,function(a,t){e.push(a),r.push(t)}),a.chartConfig.orderArea.series[0].data=e,a.chartConfig.orderArea.xAxis.categories=r}else a.orderData=[],a.statusNum=null,a.monthData=null;a.loading=!1,a.haveOrderGraphData=!0},function(){a.orderData=[],a.statusNum=null,a.monthData=null,a.loading=!1,a.haveOrderGraphData=!0,toaster.pop("error","首页","获取订单数据出错！")})},a.cashLoading=!0,a.welcomeCashData=function(){a.cashLoading=!0,a.haveCashGraphData=!1,a.chartConfig.cashArea.series[0].data=[];var e=t.welcomeCashData({});return e.then(function(t){if(t&&0==t.code){a.cashData=t.data;var e=[],r=[];angular.forEach(a.cashData.monthOrderData,function(a,t){e.push(a),r.push(t)}),a.chartConfig.cashArea.series[0].data=e,a.chartConfig.cashArea.xAxis.categories=r}a.haveCashGraphData=!0,a.cashLoading=!1},function(){toaster.pop("error","首页","获取现金流量数据出错！"),a.haveCashGraphData=!0,a.cashLoading=!1})},a.allCashData=function(){var e=t.allCashData({});return e.then(function(t){t&&0==t.code&&(a.allCash=t.data)},function(){toaster.pop("error","首页","获取总现金出错！")})},a.allOrderStatusData(),a.welcomeCashData(),a.allCashData(),a.goLink=function(a){var t="2016-12-01",r=moment().utc().endOf("day").format("YYYY-MM-DD");"send"==a?e.location.href="/admin#/app/orderlist?status=1&start="+t+"&end="+r:"sure"==a?e.location.href="/admin#/app/orderlist?status=2&start="+t+"&end="+r:"complete"==a?e.location.href="/admin#/app/orderlist?status=3&start="+t+"&end="+r:"refund"==a&&(e.location.href="/admin#/app/orderlist?status=7&start="+t+"&end="+r)}}]);