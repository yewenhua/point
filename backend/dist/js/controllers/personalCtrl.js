angular.module("app").controller("PersonalCtrl",["$scope","CommonFunction","DataLoad","toaster","$rootScope",function(e,i,o,r,n){e.user=angular.copy(n.userInfo),e.isNameExist=!1,e.isMobileExist=!1,e.isExist=function(i){var n=o.isExist(i);return n.then(function(o){o&&0==o.code&&o.data.id!=e.user.id?angular.isUndefined(i.name)?(e.isMobileExist=!0,r.pop("error","信息修改","手机号码已经存在！")):(e.isNameExist=!0,r.pop("error","信息修改","用户名已经存在！")):angular.isUndefined(i.name)?e.isMobileExist=!1:e.isNameExist=!1},function(){angular.isUndefined(i.name)?e.isMobileExist=!0:e.isNameExist=!0,r.pop("error","信息修改","获取信息出错！")})},e.mobilePattern=function(e){var i=/^1[1|2|3|4|5|6|7|8|9][0-9]\d{4,8}$/;return!!i.test(e)},e.checkName=function(){e.user.name&&e.isExist({name:e.user.name})},e.checkMobile=function(){e.user.mobile&&e.mobilePattern(e.user.mobile)&&e.isExist({mobile:e.user.mobile})};var s=!1;e.chgPersonal=function(){if(e.isNameExist||e.isMobileExist)e.isNameExist?r.pop("error","信息修改","用户名已经存在！"):r.pop("error","信息修改","手机号码已经存在！");else if(0==s){s=!0;var i=o.chgPersonal({id:n.userInfo.id,name:e.user.name,mobile:e.user.mobile});return i.then(function(i){i&&0==i.code?(n.userInfo.name=angular.copy(e.user.name),n.userInfo.mobile=angular.copy(e.user.mobile),r.pop("success","信息修改","修改成功！")):r.pop("error","信息修改","修改出错！"),s=!1},function(){s=!1,r.pop("error","信息修改","未知错误，请刷新重试！")})}}}]);