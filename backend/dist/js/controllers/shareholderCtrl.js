angular.module("app").controller("ShareholderCtrl",["$scope","CommonFunction","DataLoad","toaster",function(a,t,e,n){a.lastMonthFirstLastDay=function(){var a=(new Date).getFullYear(),t=(new Date).getMonth()+1,e=moment([a]).isLeapYear();if(1==t||3==t||5==t||7==t||8==t||10==t||12==t)if(1==t||3==t||5==t||7==t||8==t)var n={first:a+"-0"+t+"-01",last:a+"-0"+t+"-31"};else var n={first:a+"-"+t+"-01",last:a+"-"+t+"-31"};else if(4==t||6==t||9==t||11==t)if(4==t||6==t||9==t)var n={first:a+"-0"+t+"-01",last:a+"-0"+t+"-30"};else var n={first:a+"-"+t+"-01",last:a+"-"+t+"-30"};else if(2==t)if(e)var n={first:a+"-0"+t+"-01",last:a+"-0"+t+"-29"};else var n={first:a+"-0"+t+"-01",last:a+"-0"+t+"-28"};return n},a.lastMonth=a.lastMonthFirstLastDay(),a.dateSelectRange={start:moment(new Date(a.lastMonth.first)).utc().startOf("day"),end:moment(new Date(a.lastMonth.last)).utc().startOf("day")},a.$watch("dateSelectRange",function(t,e){t!=e&&a.getColumnGraphData()},!0),a.chartConfig={numberColumn:{options:{chart:{type:"column"},colors:["#27c24c","#7266ba","#23b7e5"],tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+"："+this.y+"元<br/>占百分比："+(100*this.y/this.point.stackTotal).toFixed(1)+"%"}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black"}}}}},title:{text:"现金对比图"},subtitle:{text:""},xAxis:{categories:[]},yAxis:{min:0,title:{text:"下级总现金对比图"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}},labels:{formatter:function(){return this.value/1e4+"万元"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},series:[{name:"在线报单",data:[]},{name:"后台升级",data:[]},{name:"快速报单",data:[]}]}},a.columnloading=!0,a.haveColumnGraphData=!1,a.getColumnGraphData=function(){a.haveColumnGraphData=!1,a.columnloading=!0,a.chartConfig.numberColumn.series[0].data=[],a.chartConfig.numberColumn.series[1].data=[],a.chartConfig.numberColumn.series[2].data=[];var t=e.getShareholderGraphData({start:a.dateSelectRange.start.format("YYYY-MM-DD"),end:a.dateSelectRange.end.format("YYYY-MM-DD")});return t.then(function(t){if(t&&0==t.code){a.originalColumnData=t.data;var e=[],n=[],e={online:[],backend:[],quick:[]};angular.forEach(a.originalColumnData,function(a,t){n.push(a.name),e.online[t]=a.online_declaration,e.backend[t]=a.backend_upgrade,e.quick[t]=a.quick_declaration}),a.chartConfig.numberColumn.xAxis.categories=n,a.chartConfig.numberColumn.series[0].data=e.online,a.chartConfig.numberColumn.series[1].data=e.backend,a.chartConfig.numberColumn.series[2].data=e.quick,a.haveColumnGraphData=!0}else a.haveColumnGraphData=!1;a.columnloading=!1},function(){a.columnloading=!1,a.haveColumnGraphData=!1,n.pop("error","股东数据统计","获取数据出错！")})},a.getColumnGraphData()}]);