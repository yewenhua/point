angular.module("app").controller("ConsumerankCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams","$window",function(t,a,e,o,n,r,s,l){t.haveData=!0,t.loading=!0,t.query="",t.page=1,t.totalPage=1,t.perPage=20,t.dataList=[],t.init=!0,t.submit=!1,t.sort={word:"num",type:"desc"},t.total={total_num:0,total_exchange_point:0,total_consume_point:0,total_cash:0,total_logistic_fee:0},t.thList=[{name:"数量",sort:"fa-sort-desc",selected:!0},{name:"消费积分",sort:"fa-sort",selected:!1},{name:"购物券",sort:"fa-sort",selected:!1},{name:"现金",sort:"fa-sort",selected:!1},{name:"邮费",sort:"fa-sort",selected:!1}],t.changeSort=function(a){a.selected?"fa-sort-asc"==a.sort?(a.sort="fa-sort-desc",t.sort.type="desc"):(a.sort="fa-sort-asc",t.sort.type="asc"):(a.selected=!0,a.sort="fa-sort-desc",t.sort.type="desc",angular.forEach(t.thList,function(t,e){a.name!=t.name&&(t.selected=!1,t.sort="fa-sort")})),"数量"==a.name?t.sort.word="num":"消费积分"==a.name?t.sort.word="consume_point":"购物券"==a.name?t.sort.word="exchange_point":"现金"==a.name?t.sort.word="total_cash_price":"邮费"==a.name?t.sort.word="logistic_fee":t.sort.word="num"},t.$watch("sort",function(a,e){a!=e&&(t.page=1,t.getAllData())},!0),angular.isUndefined(s.userid)?t.userid="empty":t.userid=s.userid,t.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""},t.$watch("dateSelectSingle.start",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.monthAgo=function(){var t=new Date,a=t.getTime()-2592e6,e=new Date;e.setTime(a);var o=moment(e).utc().startOf("day").format("YYYY-MM-DD");return o},t.dateSelectRange={start:moment(t.monthAgo()).utc().startOf("day"),end:moment().utc().startOf("day")},t.$watch("dateSelectRange",function(a,e){a!=e&&(t.init=!1,t.page=1,t.getAllData())},!0),t.getAllData=function(){t.loading=!0;var a=e.getConsumeStatisticPageData({searchkey:t.query,start:t.dateSelectRange.start.format("YYYY-MM-DD"),end:t.dateSelectRange.end.format("YYYY-MM-DD"),offset:(t.page-1)*t.perPage,num:t.perPage,userid:t.userid,sort_word:t.sort.word,sort_type:t.sort.type});return a.then(function(a){if(a&&0==a.code)if(t.total.total_num=a.total.total_num,t.total.total_exchange_point=a.total.total_exchange_point,t.total.total_consume_point=a.total.total_consume_point,t.total.total_cash=a.total.total_cash,t.total.total_logistic_fee=a.total.total_logistic_fee,0!=a.data.data.length){t.haveData=!0,t.dataList=a.data.data,t.totalPage=Math.ceil(a.data.count/t.perPage);var e=$("#divpage-page");n.getready(e,t.totalPage,t.page)}else t.dataList=[],o.pop("success","消费排行","没有数据！"),t.haveData=!1;else t.dataList=[],t.haveData=!1,o.pop("error","消费排行",a.message);t.loading=!1},function(){t.dataList=[],t.haveData=!1,t.loading=!1,o.pop("error","消费排行","获取数据出错！")})},t.getAllData(),t.isFirst=function(t){return 1==t},t.isDisable=function(a){return 1==a&&1==t.totalPage?!0:!(a<t.totalPage)},t.getInfoPage=function(a){a<=t.totalPage&&a>0&&(t.page=a,t.getAllData())},t.divpageByPage=function(a){var e=$(a.currentTarget).html(),o=Number(e);angular.isNumber(o)&&o>0&&t.getInfoPage(o)},t.searchData=function(){t.page=1,t.getAllData()},t.detail=function(a){t.dateSelectRange.start.format("YYYY-MM-DD"),t.dateSelectRange.end.format("YYYY-MM-DD")}}]);