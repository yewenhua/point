angular.module("app").controller("LogisticCtrl",["$scope","CommonFunction","DataLoad","toaster","divpage","$modal","$stateParams",function(e,t,a,l,n,i,s){e.haveData=!0,e.loading=!0,e.query="",e.page=1,e.totalPage=1,e.perPage=10,e.dataList=[],e.init=!0,e.selectAll=!1,e.all_delete_disabled=!0,e.all_delete_html="删除",e.submit=!1,e.editing=!1,e.creating=!1,e.updateData={},e.openData={},e.openData.isNew=!0,e.openData.addr_list=[],e.is_open=!0,e.$watch("is_open",function(t,a){t!=a&&(e.page=1,e.getAllData())}),e.itemData={name:"",is_lock:!0,isNew:!0,send_list:[]},e.getAllData=function(){e.loading=!0;var t=a.getLogisticPageData({searchkey:e.query,offset:(e.page-1)*e.perPage,num:e.perPage,status:e.is_open?1:0});return t.then(function(t){if(t&&0==t.code)if(0!=t.data.data.length){e.haveData=!0,e.dataList=t.data.data,angular.forEach(e.dataList,function(t,a){e.dataList[a].send_list=angular.fromJson(t.template)}),e.totalPage=Math.ceil(t.data.count/e.perPage);var a=$("#divpage-page");n.getready(a,e.totalPage,e.page)}else e.dataList=[],l.pop("success","邮费设置","没有数据！"),e.haveData=!1;else e.dataList=[],e.haveData=!1,l.pop("error","邮费设置",t.message);e.loading=!1},function(){e.dataList=[],e.haveData=!1,e.loading=!1,l.pop("error","邮费设置","获取数据出错！")})},e.getAllData(),e.isFirst=function(e){return 1==e},e.isDisable=function(t){return 1==t&&1==e.totalPage?!0:!(t<e.totalPage)},e.getInfoPage=function(t){t<=e.totalPage&&t>0&&(e.page=t,e.getAllData())},e.divpageByPage=function(t){var a=$(t.currentTarget).html(),l=Number(a);angular.isNumber(l)&&l>0&&e.getInfoPage(l)},e.searchData=function(){e.page=1,e.getAllData()},e.$watch("dataList",function(t,a){t!=a&&e.dataList.length>0&&(e.num=0,e.all=0,angular.forEach(e.dataList,function(t,a){t.selected&&e.num++,e.all++}),e.num>0?e.all_delete_disabled=!1:e.all_delete_disabled=!0,e.num==e.all?e.selectAll=!0:e.selectAll=!1)},!0),e.$watch("selectAll",function(t,a){t!=a&&e.dataList.length>0&&(t?angular.forEach(e.dataList,function(e,t){e.selected=!0}):(e.count=0,e.all=0,angular.forEach(e.dataList,function(t,a){t.selected&&e.count++,e.all++}),e.count==e.all&&angular.forEach(e.dataList,function(e,t){e.selected=!1})))}),e.deleteBatch=function(){if(1==confirm("确定要删除吗?")&&0==e.submit){e.submit=!0,e.idlist=[],angular.forEach(e.dataList,function(t,a){1==t.selected&&e.idlist.push(t.id)});var t=a.deleteLogisticBatch({idlist:JSON.stringify(e.idlist)});return t.then(function(t){e.all_disagree_disabled=!1,e.all_delete_html="删除",t&&0==t.code?(l.pop("success","邮费设置",t.message),location.reload()):(e.submit=!1,l.pop("error","邮费设置",t.message))},function(){e.submit=!1,e.all_disagree_disabled=!1,e.all_delete_html="删除",l.pop("error","邮费设置","操作出错！")})}},e.createNew=function(){e.itemData={name:"",is_lock:!0,isNew:!0,send_list:[{isDefault:!0,isNew:!1,select_all:!0,first_weight:1e3,first_fee:10,other_weight:1e3,other_fee:8,addr_list:[]}]},e.openData.isNew=!0,e.openData.addr_list=[],e.creating=!0},e.cancel=function(){e.editing=!1,e.creating=!1},e.updateItem=function(t){e.editing=!0,e.itemData=angular.copy(t),e.itemData.is_lock=1==e.itemData.is_lock,e.itemData.isNew=!1,e.itemData.template=angular.fromJson(e.itemData.template),e.itemData.send_list=e.itemData.template},e.updateAddr=function(t,a){e.openData=angular.copy(t),e.openData.isNew=!1,e.openData.index=a,e.open(e.openData,"lg")},e.insertAddr=function(){e.openData={},e.openData.isDefault=!1,e.openData.isNew=!0,e.openData.addr_list=[],e.open(e.openData,"lg")},e.open=function(t,a){var l=i.open({templateUrl:"logisticModalContent",controller:"logisticModalInstanceCtrl",size:a,resolve:{item:function(){return t}}});l.result.then(function(t){if(angular.isDefined(t)){var a=angular.copy(t.data);a.isNew?(a.isNew=!1,e.itemData.send_list.push(a)):angular.forEach(e.itemData.send_list,function(t,l){l==a.index&&(e.itemData.send_list[l]=a)})}},function(){})},e.submitItem=function(){if(0==e.submit){e.submit=!0;var t=a.updateLogistic({id:e.itemData.isNew?"":e.itemData.id,name:e.itemData.name,is_lock:e.itemData.is_lock?1:0,template:angular.toJson(e.itemData.send_list)});return t.then(function(t){e.all_disagree_disabled=!1,e.all_delete_html="删除",t&&0==t.code?(l.pop("success","邮费设置",t.message),e.editing=!1,e.creating=!1,e.getAllData()):l.pop("error","邮费设置",t.message),e.submit=!1},function(){e.submit=!1,e.all_disagree_disabled=!1,e.all_delete_html="删除",l.pop("error","邮费设置","操作出错！")})}}}]),angular.module("app").controller("logisticModalInstanceCtrl",["$rootScope","$scope","$modalInstance","toaster","item","$rootScope","DataLoad",function(e,t,a,l,n,e,i){t.item=angular.copy(n),t.item.isNew&&(t.item.first_weight="1000",t.item.first_fee="0",t.item.other_weight="1000",t.item.other_fee="0"),t.province_list=[{name:"全国",selected:!1},{name:"北京市",selected:!1},{name:"天津市",selected:!1},{name:"上海市",selected:!1},{name:"重庆市",selected:!1},{name:"河北省",selected:!1},{name:"河南省",selected:!1},{name:"云南省",selected:!1},{name:"辽宁省",selected:!1},{name:"黑龙江省",selected:!1},{name:"湖南省",selected:!1},{name:"安徽省",selected:!1},{name:"山东省",selected:!1},{name:"新疆",selected:!1},{name:"江苏省",selected:!1},{name:"浙江省",selected:!1},{name:"江西省",selected:!1},{name:"湖北省",selected:!1},{name:"广西",selected:!1},{name:"甘肃省",selected:!1},{name:"山西省",selected:!1},{name:"内蒙古",selected:!1},{name:"陕西省",selected:!1},{name:"吉林省",selected:!1},{name:"福建省",selected:!1},{name:"贵州省",selected:!1},{name:"广东省",selected:!1},{name:"青海省",selected:!1},{name:"西藏",selected:!1},{name:"四川省",selected:!1},{name:"宁夏",selected:!1},{name:"海南省",selected:!1},{name:"台湾省",selected:!1},{name:"香港",selected:!1},{name:"澳门",selected:!1}],t.item.addr_list.length>0&&angular.forEach(t.province_list,function(e,a){angular.forEach(t.item.addr_list,function(t,a){e.name==t.name&&(e.selected=!0)})}),angular.isUndefined(t.item.select_all)&&(t.item.select_all=!1),t.submit=!1,t.submitBtnHtml="提交",t.item.isDefault&&(t.item.select_all=!0,angular.forEach(t.province_list,function(e,t){e.selected=!0})),t.$watch("item.select_all",function(e,a){e!=a&&t.province_list.length>0&&(e?angular.forEach(t.province_list,function(e,t){e.selected=!0}):(t.count=0,t.all=0,angular.forEach(t.province_list,function(e,a){e.selected&&t.count++,t.all++}),t.count==t.all&&angular.forEach(t.province_list,function(e,t){e.selected=!1})))}),t.$watch("province_list",function(e,a){e!=a&&t.province_list.length>0&&(t.num=0,t.all=0,angular.forEach(t.province_list,function(e,a){e.selected&&t.num++,t.all++}),t.num==t.all?t.item.select_all=!0:t.item.select_all=!1)},!0),t.addr_list=[],t.cancle=function(){angular.forEach(t.province_list,function(e,a){e.selected&&t.addr_list.push(e)}),t.item.addr_list=angular.copy(t.addr_list);var e={type:"cancel",data:t.item};a.close(e)}}]);