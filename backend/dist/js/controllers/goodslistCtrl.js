app.controller("GoodlistCtrl",["$scope","$state","$timeout","toaster","DataLoad","divpage","$rootScope","$modal","CommonFunction","$stateParams","FileUploader",function(a,t,o,e,i,n,r,d,s,l,c){function g(a,t){return a-t}a.dataList=[],a.branch=null,a.haveData=!0,a.loading=!0,a.doing_async=!0,a.query="",a.page=1,a.totalPage=1,a.perPage=10,a.editing=!1,a.moveable=!1,a.imgData=[],a.goodsData={},a.goodsData.name="",a.goodsData.is_option=!1,a.goodsData.options=[],a.goodsData.optionList=[],a.goodsData.total="",a.goodsData.market_price=0,a.goodsData.point_price="",a.goodsData.cash_price="",a.goodsData.desc="",a.goodsData.imgData="",a.goodsData.is_release=!0,a.goodsData.is_time_buy=!1,a.dateSelectBuy="",a.goodsData.is_share=!1,a.goodsData.share_price="",a.goodsData.model=1,a.goodsData.url="",a.goodsData.send_method="",a.goodsData.weight="",a.goodsData.limit_buy="",a.goodsData.company_id="",a.goodsData.company_get_type=1,a.goodsData.company_useable_point=0,a.goodsData.send_type={},a.goodsData.send_type.logistic=!1,a.goodsData.send_type.self=!1,a.init=!0,a.selectAll=!1,a.all_delete_disabled=!0,a.all_delete_html="删除",a.radioModel=99,a.init_loading=!0,a.click_modify_cancle=!1,a.merchantModel=99,angular.isUndefined(l.type)?a.radioModel=99:a.radioModel=Number(l.type),a.init_logistic={loading:!0,error:!1,data:[]},a.modify={doing:!1,branch:null,page:1},a.init_company={loading:!0,error:!1,data:[]},a.$watch("radioModel",function(t,o){t!=o&&(a.init_loading||(a.page=1,a.getAllData()))}),a.$watch("merchantModel",function(t,o){t!=o&&(a.init_loading||(a.page=1,a.getAllData()))}),angular.isUndefined(l.key)||(a.query=l.key),a.dateSelectSingle={start:moment(new Date).utc().startOf("day"),end:""};var p;a.my_tree_handler=function(t){a.branch=t;var o;return a.output="您选择了: "+t.label,(null!=(o=t.data)?o.description:void 0)?a.output+="("+t.data.description+")":void(a.editing||a.modify.doing?a.click_modify_cancle&&(a.modify.doing=!1,a.click_modify_cancle=!1):(a.haveData=!0,a.page=1,a.totalPage=1,a.perPage=10,a.getAllData(),a.initItemData()))},a.my_data=[],a.my_tree=p={},a.originalData=[],a.getTreeData=function(){a.doing_async=!0;var n=i.treeAllData({});return n.then(function(i){if(i&&0==i.code)if(0!=i.data.length){a.originalData=i.data;var n=[];angular.forEach(a.originalData,function(a,t){a.children=[],1==a.is_root&&n.push(a)});for(var r=0;r<n.length;r++)angular.forEach(a.originalData,function(a,t){if(1!=a.is_root){var o=a.path.split("/");2==o.length&&o[0]==n[r].path&&n[r].children.push(a)}});for(var r=0;r<n.length;r++)angular.forEach(a.originalData,function(a,t){var o=a.path.split("/");if(1!=a.is_root&&3==o.length&&n[r].children.length>0)for(var e=0;e<n[r].children.length;e++){var i=n[r].children[e].path.split("/"),d=o[0]+o[1],s=i[0]+i[1];d==s&&n[r].children[e].children.push(a)}});for(var r=0;r<n.length;r++)angular.forEach(a.originalData,function(a,t){var o=a.path.split("/");if(1!=a.is_root&&4==o.length&&n[r].children.length>0)for(var e=0;e<n[r].children.length;e++)if(n[r].children[e].children.length>0)for(var i=0;i<n[r].children[e].children.length;i++){var d=n[r].children[e].children[i].path.split("/"),s=o[0]+o[1]+o[2],l=d[0]+d[1]+d[2];s==l&&n[r].children[e].children[i].children.push(a)}});a.my_data=n}else e.pop("error","商品管理","没有数据！");else{if(null==i)return sessionStorage.removeItem("userInfo"),t.go("access.signin"),!1;e.pop("error","商品管理",i.message)}a.doing_async=!1,o(function(){a.expand_all()},200)},function(){a.doing_async=!1,e.pop("error","商品管理"," 获取菜单出错！")})},a.getTreeData(),a.expand_all=function(){p.expand_all()},a.isFirst=function(a){return 1==a},a.isDisable=function(t){return 1==t&&1==a.totalPage?!0:!(t<a.totalPage)},a.getInfoPage=function(t){t<=a.totalPage&&t>0&&(a.page=t,a.getAllData())},a.divpageByPage=function(t){var o=$(t.currentTarget).html(),e=Number(o);angular.isNumber(e)&&e>0&&a.getInfoPage(e)},a.searchData=function(){a.page=1,a.getAllData()},a.$watch("dateSelectSingle.start",function(a,t){},!0),angular.isUndefined(l.start)||angular.isUndefined(l.end)?a.dateSelectRange={start:moment(new Date("2016-12-01")).utc().startOf("day"),end:moment().utc().startOf("day")}:a.dateSelectRange={start:moment(new Date(l.start)).utc().startOf("day"),end:moment(new Date(l.end)).utc().startOf("day")},a.$watch("dateSelectRange",function(t,o){t!=o&&(a.init_loading||(a.init=!1,a.page=1,a.getAllData()))},!0),a.getAllData=function(){a.loading=!0;var t=i.getGoodsPageData({path:null==a.branch?"":a.branch.path,start:a.dateSelectRange.start.format("YYYY-MM-DD"),end:a.dateSelectRange.end.format("YYYY-MM-DD"),searchkey:a.query,offset:(a.page-1)*a.perPage,num:a.perPage,status:a.radioModel,is_company:a.merchantModel});return t.then(function(t){if(t&&0==t.code)if(0!=t.data.data.length){a.haveData=!0,a.dataList=t.data.data,angular.forEach(a.dataList,function(a,t){1==a.is_release?a.open=!0:a.open=!1,1==a.is_recommend?a.recommend=!0:a.recommend=!1}),a.totalPage=Math.ceil(t.data.count/a.perPage);var o=$("#divpage-page");n.getready(o,a.totalPage,a.page)}else a.dataList=[],e.pop("success","商品管理","没有数据！"),a.haveData=!1;else a.dataList=[],a.haveData=!1,e.pop("error","商品管理","没有数据！");a.loading=!1,a.init_loading=!1},function(){a.dataList=[],a.haveData=!1,a.loading=!1,a.init_loading=!1,e.pop("error","商品管理","获取数据出错！")})},a.initItemData=function(){a.goodsData.name="",a.goodsData.is_option=!1,a.goodsData.options=[],a.goodsData.optionList=[],a.goodsData.total="",a.goodsData.market_price=0,a.goodsData.point_price="",a.goodsData.cash_price="",a.goodsData.desc="",a.goodsData.imgData="",a.goodsData.is_release=!0,a.goodsData.is_time_buy=!1,a.goodsData.is_share=!1,a.goodsData.share_price="",a.goodsData.model=1,a.goodsData.weight="",a.goodsData.limit_buy="",a.init_logistic.loading||a.init_logistic.error?a.goodsData.send_method="":a.goodsData.send_method=a.init_logistic.data[0].id,a.init_company.loading||a.init_company.error?a.goodsData.company_id="":a.goodsData.company_id=a.init_company.data[0].id,a.goodsData.company_get_type=1,a.goodsData.company_useable_point=0,a.imgData=[],a.goodsData.send_type={},a.goodsData.send_type.logistic=!1,a.goodsData.send_type.self=!1},a.add=function(){return a.init_logistic.loading?(e.pop("error","商品管理","正在加载配送方案"),!1):a.init_logistic.error?(e.pop("error","商品管理","获取配送方案出错"),!1):a.init_logistic.data<=0?(e.pop("error","商品管理","未设置配送方案"),!1):(a.imgData=[],a.goodsData.send_method=a.init_logistic.data[0].id,a.goodsData.weight="",a.goodsData.limit_buy="",a.goodsData.desc="",a.goodsData.is_release=!0,a.goodsData.is_time_buy=!1,a.goodsData.is_share=!1,a.goodsData.share_price="",a.goodsData.model=1,a.goodsData.url="",a.goodsData.send_type={},a.goodsData.send_type.logistic=!0,a.goodsData.send_type.self=!0,a.init_company.loading||a.init_company.error?a.goodsData.company_id="":a.goodsData.company_id=a.init_company.data[0].id,a.goodsData.company_get_type=1,a.goodsData.company_useable_point=0,a.editing=!0,void(a.goodsData.is_new=!0))},a.cancel=function(){a.goodsData={},a.goodsData.name="",a.goodsData.is_option=!1,a.goodsData.options=[],a.goodsData.optionList=[],a.goodsData.total="",a.goodsData.market_price=0,a.goodsData.point_price="",a.goodsData.cash_price="",a.goodsData.desc="",a.goodsData.imgData="",a.goodsData.is_release=!0,a.goodsData.is_time_buy=!1,a.goodsData.is_share=!1,a.goodsData.share_price="",a.goodsData.model=1,a.goodsData.url="",a.goodsData.send_method="",a.goodsData.company_get_type=1,a.goodsData.company_useable_point=0,a.editing=!1,a.click_modify_cancle=!0,a.goodsData.send_type={},a.goodsData.send_type.logistic=!1,a.goodsData.send_type.self=!1,a.modify.doing&&(a.branch=a.modify.branch,a.my_tree.select_branch(a.branch))},a.updateGoods=function(t){if(a.init_logistic.loading)return e.pop("error","商品管理","正在加载配送方案"),!1;if(a.init_logistic.error)return e.pop("error","商品管理","获取配送方案出错"),!1;if(a.init_logistic.data<=0)return e.pop("error","商品管理","未设置配送方案"),!1;a.modify={doing:!0,branch:angular.copy(a.branch),page:angular.copy(a.page)};var o=angular.copy(t),i=o.options?angular.fromJson(o.options):null;a.editing=!0,a.goodsData={},a.goodsData.id=o.id,a.goodsData.is_new=!1,a.goodsData.name=o.name,a.goodsData.is_option=!(!i||1!=i.is_option),a.goodsData.options=i?i.options:[],a.goodsData.optionList=i?i.optionList:[],a.goodsData.total=o.total,a.goodsData.market_price=o.market_price,a.goodsData.point_price=o.point_price,a.goodsData.cash_price=o.cash_price,a.goodsData.desc=o.description,a.goodsData.imgData=angular.fromJson(o.img_data),a.goodsData.is_release=1==o.is_release,a.goodsData.is_time_buy=1==o.is_time_buy,a.dateSelectBuy=o.buy_time,a.goodsData.is_share=1==o.is_share,a.goodsData.share_price=o.share_price,a.goodsData.model=o.model,a.goodsData.url=o.url,a.goodsData.weight=o.weight,a.goodsData.limit_buy=o.limit_buy,a.goodsData.company_get_type=o.company_get_type,a.goodsData.company_useable_point=o.company_useable_point;var n=o.send_type.split(",");a.goodsData.send_type={},a.goodsData.send_type.logistic=!1,a.goodsData.send_type.self=!1;for(var r=0;r<n.length;r++)1==n[r]?a.goodsData.send_type.logistic=!0:2==n[r]&&(a.goodsData.send_type.self=!0);o.send_method&&o.send_method>0?a.goodsData.send_method=o.send_method:a.goodsData.send_method=a.init_logistic.data[0].id,o.company_id&&o.company_id>0?a.goodsData.company_id=o.company_id:a.goodsData.company_id=a.init_company.data[0].id,a.imgData=[];for(var r=0;r<a.goodsData.imgData.length;r++){var d="/backend/uploads/"+a.goodsData.imgData[r].file,s={};s.url=d,s.name=a.goodsData.imgData[r].file,s.save_file_name=a.goodsData.imgData[r].file,a.imgData.push({file:s,selected:a.goodsData.imgData[r].selected})}for(var l=!1,r=0;r<a.my_data.length&&!l;r++){for(var c=0;c<a.my_data[r].children.length&&!l;c++){for(var g=0;g<a.my_data[r].children[c].children.length&&!l;g++){for(var p=0;p<a.my_data[r].children[c].children[g].children.length&&!l;p++)if(a.my_data[r].children[c].children[g].children[p].path==t.category){a.branch=a.my_data[r].children[c].children[g].children[p],l=!0;break}if(a.my_data[r].children[c].children[g].path==t.category){a.branch=a.my_data[r].children[c].children[g],l=!0;break}}if(a.my_data[r].children[c].path==t.category){l=!0,a.branch=a.my_data[r].children[c];break}}if(a.my_data[r].path==t.category){l=!0,a.branch=a.my_data[r];break}}if(l&&a.my_tree.select_branch(a.branch),a.modify.doing)for(var r=0;r<a.my_data.length;r++){if(a.my_data[r].node_id==a.modify.branch.node_id){a.modify.branch=a.my_data[r];break}for(var c=0;c<a.my_data[r].children.length;c++){if(a.my_data[r].children[c].node_id==a.modify.branch.node_id){a.modify.branch=a.my_data[r].children[c];break}for(var g=0;g<a.my_data[r].children[c].children.length;g++){if(a.my_data[r].children[c].children[g].node_id==a.modify.branch.node_id){a.modify.branch=a.my_data[r].children[c].children[g];break}for(var p=0;p<a.my_data[r].children[c].children[g].children.length;p++)if(a.my_data[r].children[c].children[g].children[p].node_id==a.modify.branch.node_id){a.modify.branch=a.my_data[r].children[c].children[g].children[p];break}}}}},a.deleteGoods=function(a){if(1==confirm("确定要删除吗?")){var t=i.deleteGoods({id:a.id});return t.then(function(a){a&&0==a.code?(e.pop("success","商品管理",a.message),o(function(){location.reload()},1500)):e.pop("error","商品管理",a.message)},function(){e.pop("error","商品管理","删除出错")})}};var u=a.uploader=new c({url:"/backend/upload_soft.php"});u.filters.push({name:"customFilter",fn:function(a,t){return this.queue.length<10}}),u.onAfterAddingFile=function(t){return a.uploader.queue.length>10?(a.uploader.queue.pop(),e.pop("error","商品管理","最多可上传10个文件"),!1):void angular.forEach(a.uploader.queue,function(t){var o=t.file.name;return-1===o.indexOf(".jpg")&&-1===o.indexOf(".jpeg")&&-1===o.indexOf(".png")?(e.pop("error","商品管理","上传文件扩展名必须为：.jpg .png .jpeg"),a.uploader.queue.pop(),!1):void 0})},u.onCompleteItem=function(t,o,i,n){0==o.code?($(".bootstrap-filestyle").children("input").val(""),t.file.url="/backend/uploads/"+o.file,t.file.save_file_name=o.file):e.pop("error","商品管理",o.answer),t.selected=!1,a.imgData.push(t)},a.deleteImg=function(t,o){if(t.stopPropagation(),1==confirm("确定要删除吗?")){var n=i.deleteImg({id:a.goodsData.is_new?"":a.goodsData.id,file:o.file.save_file_name});return n.then(function(t){if(t&&0==t.code){a.imgData.splice(a.imgData.indexOf(o),1);var i=a.uploader.queue.indexOf(o);-1!==i&&a.uploader.queue.splice(a.uploader.queue.indexOf(o),1),e.pop("success","商品管理",t.message)}else e.pop("error","商品管理",t.message)},function(){e.pop("error","商品管理","删除出错")})}},a.submitBtnHtml="提交",a.save=function(){a.submitBtnHtml="提交中…";var t=[];if(angular.forEach(a.imgData,function(a){t.push({file:a.file.save_file_name,selected:a.selected})}),a.goodsData.is_release)var n=1;else var n=0;if(a.goodsData.is_time_buy)var r=1;else var r=0;if(a.goodsData.is_share)var d=1;else var d=0;if(a.goodsData.send_type.logistic&&a.goodsData.send_type.self)var s="1,2";else if(a.goodsData.send_type.logistic&&!a.goodsData.send_type.self)var s="1";else{if(a.goodsData.send_type.logistic||!a.goodsData.send_type.self)return e.pop("error","商品管理","请选择配送方式"),a.submitBtnHtml="提交",!1;var s="2"}var l={is_option:a.goodsData.is_option?1:0,options:a.goodsData.options,optionList:a.goodsData.optionList},c=i.saveGoods({id:a.goodsData.is_new?"":a.goodsData.id,category:null==a.branch?"":a.branch.path,name:a.goodsData.name,options:angular.toJson(l),desc:a.goodsData.desc,market_price:a.goodsData.market_price,point_price:a.goodsData.point_price,cash_price:a.goodsData.cash_price,total:a.goodsData.total,model:a.goodsData.model,is_release:n,img_data:angular.toJson(t),send_method:a.goodsData.send_method,weight:a.goodsData.weight,limit_buy:a.goodsData.limit_buy,company_id:a.goodsData.company_id,company_get_type:a.goodsData.company_get_type,company_useable_point:a.goodsData.company_useable_point,send_type:s,is_time_buy:r,buy_time:a.dateSelectBuy,is_share:d,share_price:a.goodsData.share_price});return c.then(function(t){a.submitBtnHtml="提交",t&&0==t.code?(e.pop("success","商品管理",t.message),a.goodsData.name="",a.goodsData.is_option=!1,a.goodsData.options=[],a.goodsData.optionList=[],a.goodsData.market_price=0,a.goodsData.point_price="",a.goodsData.cash_price="",a.goodsData.total="",a.uploader.queue=[],a.uploader.progress=0,o(function(){a.modify.doing?(a.branch=a.modify.branch,a.my_tree.select_branch(a.branch),a.page=angular.copy(a.modify.page),a.getAllData()):a.getAllData(),a.editing=!1},1500)):e.pop("error","商品管理",t.message)},function(){a.submitBtnHtml="提交",e.pop("error","商品管理","图片上传出错！")})},a.submit=function(t){if(a.uploader.queue.length<=0&&a.imgData.length<=0)return e.pop("error","商品管理","商品图片不能为空！"),!1;if(!a.goodsData.total&&!a.goodsData.is_option)return e.pop("error","商品管理","商品库存不能为空！"),!1;if(!a.goodsData.point_price)return e.pop("error","商品管理","商品积分价格不能为空！"),!1;if(3==a.goodsData.model&&!a.goodsData.cash_price)return e.pop("error","商品管理","商品现金价格不能为空！"),!1;if(!a.goodsData.desc)return e.pop("error","商品管理","商品描述不能为空！"),!1;if(!a.goodsData.model)return e.pop("error","商品管理","兑换模式不能为空！"),!1;if(a.goodsData.is_share&&!a.goodsData.share_price)return e.pop("error","商品管理","分享价格不能为空！"),!1;var o=!1;if(angular.forEach(a.imgData,function(a,t){a.selected&&(o=!0)}),!o)return e.pop("error","商品管理","请选项商品封面"),!1;var i=!1;angular.forEach(a.uploader.queue,function(a,t){angular.isDefined(a.file.url)&&(i=!0)}),i||a.imgData.length>0?(a.goodsData.imgData=angular.copy(a.imgData),a.save()):e.pop("error","文件上传","请先点击上传按钮上传文件")},a.setFace=function(t,o){t.stopPropagation();var e=angular.copy(o.selected);angular.forEach(a.imgData,function(a,t){a.selected=!1}),e?o.selected=!1:o.selected=!0},a.price=function(a){if(1==a.model||2==a.model)var t=a.point_price+"分";else if(3==a.model)var t=a.point_price+"分 + "+a.cash_price+"元";return t},a.switch_status=function(a){if(a.open)var t=1;else var t=0;var o=i.switch_status({id:a.id,value:t});return o.then(function(a){a&&0==a.code?e.pop("success","商品管理",a.message):e.pop("error","商品管理",a.message)},function(){e.pop("error","商品管理","修改出错")})},a.recommend_status=function(a){if(a.recommend)var t=1;else var t=0;var o=i.recommend_status({id:a.id,value:t});return o.then(function(a){a&&0==a.code?e.pop("success","商品管理",a.message):e.pop("error","商品管理",a.message)},function(){e.pop("error","商品管理","修改出错")})},a.$watch("dataList",function(t,o){t!=o&&a.dataList.length>0&&(a.num=0,a.all=0,angular.forEach(a.dataList,function(t,o){t.selected&&a.num++,a.all++}),a.num>0?(a.all_delete_disabled=!1,1==a.num?a.moveable=!0:a.moveable=!1):(a.moveable=!1,a.all_delete_disabled=!0),a.num==a.all?a.selectAll=!0:a.selectAll=!1)},!0),a.$watch("selectAll",function(t,o){t!=o&&a.dataList.length>0&&(t?angular.forEach(a.dataList,function(a,t){a.selected=!0}):(a.count=0,a.all=0,angular.forEach(a.dataList,function(t,o){t.selected&&a.count++,a.all++}),a.count==a.all&&angular.forEach(a.dataList,function(a,t){a.selected=!1})))}),a.submitFlag=!1,a.deleteBatch=function(){if(1==confirm("确定要删除吗?")&&0==a.submitFlag){a.submitFlag=!0,a.idlist=[],angular.forEach(a.dataList,function(t,o){1==t.selected&&a.idlist.push(t.id)});var t=i.deleteGoodsBatch({idlist:JSON.stringify(a.idlist)});return t.then(function(t){a.all_disagree_disabled=!1,a.all_delete_html="删除",t&&0==t.code?(e.pop("success","商品管理",t.message),location.reload()):(a.submitFlag=!1,e.pop("error","商品管理",t.message))},function(){a.submitFlag=!1,a.all_disagree_disabled=!1,a.all_delete_html="删除",e.pop("error","商品管理","操作出错！")})}},a.getLogisticList=function(){a.init_logistic={loading:!0,error:!1,data:[]};var t=i.getLogisticList({});return t.then(function(t){a.init_logistic.loading=!1,t&&0==t.code?(a.init_logistic.error=!1,a.init_logistic.data=t.data):a.init_logistic.error=!0},function(){a.init_logistic.loading=!1,a.init_logistic.error=!0,e.pop("error","商品管理","获取配送方式出错")})},a.getLogisticList(),a.up=function(){if(a.selectSortItem="",a.selectSortIndex="",angular.forEach(a.dataList,function(t,o){t.selected&&(a.selectSortItem=angular.copy(t),a.selectSortIndex=angular.copy(o))}),""!=a.selectSortItem&&""!==a.selectSortIndex)if(a.offset=(a.page-1)*a.perPage+a.selectSortIndex-1,a.offset<0)e.pop("error","商品管理","没有上一条了");else{var t="up";a.changeSortEachother(a.selectSortItem.id,a.selectSortItem.sort_id,a.offset,t)}else e.pop("error","商品管理","操作出错！")},a.down=function(){if(a.selectSortItem="",a.selectSortIndex="",angular.forEach(a.dataList,function(t,o){t.selected&&(a.selectSortItem=angular.copy(t),a.selectSortIndex=angular.copy(o))}),""!=a.selectSortItem&&""!==a.selectSortIndex){var t="down";a.offset=(a.page-1)*a.perPage+a.selectSortIndex+1,a.changeSortEachother(a.selectSortItem.id,a.selectSortItem.sort_id,a.offset,t)}else e.pop("error","商品管理","操作出错！")},a.top=function(){a.selectSortItem="",angular.forEach(a.dataList,function(t,o){t.selected&&(a.selectSortItem=angular.copy(t))});var t=i.changeSortTop({id:a.selectSortItem.id});return t.then(function(t){t&&0==t.code?(a.page=1,a.getAllData()):e.pop("error","商品管理",t.message)},function(){e.pop("error","商品管理","操作出错！")})},a.changeSortEachother=function(t,o,n,r){var d=i.changeSortGoods({id:t,sort_id:o,offset:n,type:r});return d.then(function(t){t&&0==t.code?a.getAllData():e.pop("error","商品管理",t.message)},function(){e.pop("error","商品管理","操作出错！")})},a.selectCompanyData=function(){a.init_company={loading:!0,error:!1,data:[]};var t=i.selectCompanyData({});return t.then(function(t){a.init_company.loading=!1,t&&0==t.code?(a.init_company.error=!1,a.init_company.data=t.data,a.init_company.data.unshift({id:0,name:"无",mobile:""}),a.goodsData.company_id=a.init_company.data[0].id):(a.init_company.error=!0,e.pop("error","商品管理","未设置商家"))},function(){a.init_company.loading=!1,a.init_company.error=!0,e.pop("error","商品管理","获取商家信息出错")})},a.selectCompanyData(),a.insertOption=function(){var t=a.goodsData.options.length+1+"1";a.goodsData.options.push({title:"",child:[{title:"",attr_id:t}]})},a.deleteOption=function(t){a.goodsData.options.splice(t,1)},a.insertItemOption=function(a,t){if(0==t.child.length)var o=a+1+"1";else{for(var e=[],i=0;i<t.child.length;i++){var n=t.child[i].attr_id,r=Number(n.substring(1));e.push(r)}e.sort(g);var d=e.length-1,s=e[d]+1,o=a+1+""+s}t.child.push({title:"",attr_id:o})},a.deleteItemOption=function(a,t){a.splice(t,1)},a.goodsData.optionList=[],a.$watch("goodsData.options",function(t,o){if(t!=o&&a.goodsData.options.length>0)if(1==a.goodsData.options.length&&a.goodsData.options[0].child.length>0){var e=angular.copy(a.goodsData.optionList);a.goodsData.optionList=[],angular.forEach(a.goodsData.options[0].child,function(t,o){if(t.title){for(var i=0,n=0;n<e.length;n++)e[n].title==t.title&&(i=e[n].num);a.goodsData.optionList.push({title:t.title,subTitle:null,num:i,attr_id:t.attr_id})}})}else if(2==a.goodsData.options.length&&a.goodsData.options[0].child.length>0&&a.goodsData.options[1].child.length>0){var e=angular.copy(a.goodsData.optionList);a.goodsData.optionList=[],angular.forEach(a.goodsData.options[0].child,function(t,o){angular.forEach(a.goodsData.options[1].child,function(o,i){if(t.title&&o.title){for(var n=0,r=0;r<e.length;r++)e[r].title==t.title&&e[r].subTitle==o.title&&(n=e[r].num);var d=t.attr_id+";"+o.attr_id;a.goodsData.optionList.push({title:t.title,subTitle:o.title,num:n,rowspan:a.goodsData.options[1].child.length,attr_id:d})}})})}},!0),a.isDisplayNew=function(){return!!(a.goodsData.is_option&&a.goodsData.options.length<=1)},a.rowTitle=function(t){return 0!==t&&a.goodsData.optionList[t].title==a.goodsData.optionList[t-1].title?"":a.goodsData.optionList[t].title},a.$watch("dateSelectBuy",function(a,t){})}]);